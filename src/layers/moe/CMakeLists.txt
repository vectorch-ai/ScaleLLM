include(cc_library)
include(cc_test)

cc_library(
  NAME
    token_dispatcher 
  HDRS
    token_dispatcher.h
    permutation.h
    local_token_dispatcher.h
    alltoall_token_dispatcher.h
  SRCS
    permutation.cpp
    local_token_dispatcher.cpp
    alltoall_token_dispatcher.cpp
  DEPS
    :process_group
    glog::glog
    gflags::gflags
    torch
)

cc_test(
  NAME
    token_dispatcher_test
  SRCS
    token_dispatcher_test.cpp
  DEPS
    :token_dispatcher
    absl::random_random
    :gtest_main
)
include(cc_library)
include(cc_test)

cc_library(
  NAME
    quantization
  HDRS
    pack_utils.h
    parallel_qlinear.h
    parallel_qlinear_gptq.h
    qlinear_exllamav2_impl.h
    qlinear_awq_impl.h
    qlinear_gptq_marlin_impl.h
    qlinear_awq_marlin_impl.h
  SRCS
    pack_utils.cpp
    parallel_qlinear.cpp
    parallel_qlinear_gptq.cpp
    qlinear_exllamav2_impl.cpp
    qlinear_awq_impl.cpp
    qlinear_gptq_marlin_impl.cpp
    qlinear_awq_marlin_impl.cpp
  DEPS
    :state_dict
    :linear
    :gptq.kernels
    :awq.kernels
    :marlin.kernels
    :exllamav2.kernels
    glog::glog
    gflags::gflags
    torch
)

cc_test(
  NAME
    qlinear_test
  SRCS
    pack_utils_test.cpp
    parallel_qlinear_test.cpp
    parallel_qlinear_gptq_test.cpp
  DEPS
    :quantization
    :state_dict
    :gtest_main
  DATA
    data/gptq_small.safetensors
    data/gptq.safetensors
)

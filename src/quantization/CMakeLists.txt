include(cc_library)
include(cc_test)

cc_library(
  NAME 
    quantization
  HDRS 
    pack_utils.h
    qlinear_impl.h
    qlinear_gptq_impl.h
    qlinear_exllamav2_impl.h
    qlinear_awq_impl.h
    qlinear_gptq_marlin_impl.h
    qlinear_awq_marlin_impl.h
  SRCS 
    pack_utils.cpp
    qlinear_impl.cpp
    qlinear_gptq_impl.cpp
    qlinear_exllamav2_impl.cpp
    qlinear_awq_impl.cpp
    qlinear_gptq_marlin_impl.cpp
    qlinear_awq_marlin_impl.cpp
  DEPS
    :state_dict
    :linear
    :gptq.kernels
    :awq.kernels
    :marlin.kernels
    :exllamav2.kernels
    glog::glog
    gflags::gflags
    torch
)

cc_test(
  NAME
    quantization_test
  SRCS
    pack_utils_test.cpp
    qlinear_impl_test.cpp
  DEPS
    :quantization
    :state_dict
    :gtest_main
  DATA 
    data/gptq_small.safetensors
    data/gptq.safetensors
)

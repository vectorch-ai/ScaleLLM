include(cc_library)
include(cc_test)

cc_library(
  NAME 
    engine
  HDRS
    parameters.h
    utils.h
    batch.h
    model_runner.h
    worker.h
    engine.h
    llm_engine.h
  SRCS
    utils.cpp
    batch.cpp
    model_runner.cpp
    worker.cpp
    llm_engine.cpp
  DEPS
    torch
    :common
    :request
    :state_dict
    :models
    :sampler
    :tokenizer
    :model_loader
    glog::glog
    Folly::folly
    absl::synchronization
)

cc_library(
  NAME 
    engine_factory
  HDRS
    engine_factory.h
  SRCS
    engine_factory.cpp
  DEPS
    :engine
    :speculative
    absl::strings
    glog::glog
)

cc_test(
  NAME
    engine_test
  SRCS
    batch_test.cpp
    worker_test.cpp
  DEPS
    :engine
    absl::time
    GTest::gtest_main
)
